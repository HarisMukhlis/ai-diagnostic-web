<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Diagnostic System - Hospital</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark bg-navy shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold fs-3" href="#">
    <img src="scan.png" alt="Logo Otak" class="img-logo me-2"> 
    SCAN DIAGNOSIS AI
</a>
        </div>
    </nav>

    <div class="container my-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                
                <div class="card shadow-lg mb-5" id="input-section">
                    <div class="card-header bg-teal text-white fw-bold">
                        Pilih Sumber Citra
                    </div>
                    <div class="card-body p-4">
                        <div class="row text-center">
                            
                            <div class="col-md-6 mb-3">
                                <button class="btn btn-outline-primary w-100 p-4" onclick="showUploadForm()">
                                    <i class="fas fa-upload fa-2x d-block mb-2"></i>
                                    <strong>Upload Gambar Scan/Foto</strong>
                                </button>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <button class="btn btn-outline-success w-100 p-4" onclick="showWebcamForm()">
                                    <i class="fas fa-camera fa-2x d-block mb-2"></i>
                                    <strong>Ambil dari Live Webcam</strong>
                                </button>
                            </div>
                        </div>

                        <div id="upload-form" class="mt-4 p-3 border rounded" style="display:none;">
                            <h5 class="mb-3 text-primary"> Unggah Citra & Pilih Jenis Diagnosis</h5>
                            <div class="mb-3">
                                <label for="imageUpload" class="form-label">Pilih File Gambar (JPG/PNG)</label>
                                <input class="form-control" type="file" id="imageUpload" accept="image/*">
                            </div>
                            <div class="mb-3">
                                <label for="diagnosisType" class="form-label">Jenis Citra (Wajib Dipilih)</label>
                                <select class="form-select" id="diagnosisType">
                                    <option value="" selected disabled>Pilih salah satu...</option>
                                    <option value="brain-mri">Scan MRI Otak (Tumor)</option>
                                    <option value="skin-photo">Foto Kulit (Skabies)</option>
                                </select>
                            </div>
                            <button class="btn btn-primary w-100 mt-2" onclick="processDetection()">
                                <strong>Submit untuk Deteksi</strong>
                            </button>
                        </div>

                        <div id="webcam-form" class="mt-4 p-3 border rounded" style="display:none;">
                            <h5 class="mb-3 text-success"> Pengambilan Gambar Real-Time</h5>
                            <div class="webcam-container">
                                <video id="webcamFeed" class="w-100 rounded" autoplay playsinline></video>
                                <div id="bounding-box"></div> <canvas id="webcamCanvas" style="display:none;"></canvas>
                            </div>
                            <button class="btn btn-success w-100 mt-3" onclick="captureAndSubmit()">
                                <i class="fas fa-check-circle"></i> <strong>Ambil & Submit</strong>
                            </button>
                            <button class="btn btn-secondary w-100 mt-2" onclick="stopWebcam()">
                                <i class="fas fa-power-off"></i> Matikan Kamera
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card shadow-lg mb-5" id="process-section" style="display:none;">
                    <div class="card-header bg-teal text-white fw-bold"> ⏳ Proses Deteksi AI Berlangsung...
                    </div>
                    <div class="card-body text-center p-5">
                        <p class="lead">Mengirimkan citra untuk diolah oleh program Python AI.</p>
                        <div class="progress mb-3">
                            <div class="progress-bar progress-bar-striped bg-teal" id="detection-progress" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                        </div>
                        <p class="text-muted">Mohon tunggu, proses ini mungkin memakan waktu beberapa detik.</p>
                    </div>
                </div>

                <div class="card shadow-lg" id="result-section" style="display:none;">
                    <div class="card-header bg-navy text-white fw-bold">
                        ✅ Hasil Diagnosis
                    </div>
                    <div class="card-body p-4">
                        <div class="row">
                            <div class="col-md-6 mb-3 text-center">
                                <h6>Citra Hasil Deteksi</h6>
                                <img id="output-image" src="" alt="Output Deteksi" class="img-fluid border rounded shadow-sm">
                                
                                <!-- NEWLY ADDED for MASK -->
                                <h6 class="mt-3" id="mask-title">Estimasi Area Tumor (Mask)</h6>
                                <img id="mask-image" src="" alt="Mask Area Tumor" class="img-fluid border rounded shadow-sm" style="display:none; background-color: #000;">
                            </div>
                            <div class="col-md-6">
                                <h6>Detail Hasil Analisis</h6>
                                <table class="table table-bordered table-sm">
                                    <tr>
                                        <td class="fw-bold">Jenis Diagnosis</td>
                                        <td id="res-type"></td>
                                    </tr>
                                    <tr>
                                        <td class="fw-bold">Hasil Klasifikasi</td>
                                        <td id="res-classification" class="text-danger fw-bold"></td>
                                    </tr>
                                    <tr>
                                        <td class="fw-bold">Keyakinan (Confidence)</td>
                                        <td id="res-confidence"></td>
                                    </tr>
                                    <tr>
                                        <td class="fw-bold">Estimasi Area</td>
                                        <td id="res-size"></td>
                                    </tr>
                                </table>
                                <p class="mt-3" id="res-explanation"><strong>Penjelasan Singkat:</strong> ...</p>
                            </div>
                        </div>
                        <hr>
                        <button class="btn btn-primary w-100" onclick="refreshPage()">
                            <i class="fas fa-sync-alt"></i> <strong>Mulai Diagnosa Baru</strong>
                        </button>
                    </div>
                </div>
                
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="./script.js"></script>
</body>
</html>